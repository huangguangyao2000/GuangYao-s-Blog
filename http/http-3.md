# HTTP-3-parsing-HTTP-messages

## 报文

### 请求报文

1. 报文首部
   1. 请求行
   2. 请求首部字段
   3. 通用首部字段
   4. 实体首部字段
   5. 其他
2. 空行
3. 报文主体——应被发送的数据

### **请求报文**

1. 报文首部
   1. 状态行
   2. 响应首部字段
   3. 通用首部字段
   4. 实体首部字段
   5. 其他
2. 空行
3. 报文主体——应被发送的数据

## 编码

### 报文主体和实体主体的差异

* 报文：HTTP通信中的**基本单位**，由**8位组字节流**组成，通过HTTP通信传输。
* 实体：作为请求或响应的**有效载荷数据（补充项）被传输**，其内容由实体首部和实体主体组成。

### 压缩传输的内容编码

内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。

常用内容编码：

* gzip（GNU zip）
* compress（UNIX 系统的标准压缩）
* deflate（zlib）
* identity（不进行编码）

### 分块传输编码

为使浏览器能逐步显示页面，需将实体分块传输，此功能为分块传输编码。

### 发送多种数据的多部分对象集合

## 获取部分内容的范围请求

为能从之前下载中断处继续恢复下载，需指定下载的实体范围。指定范围发送的请求叫做范围请求

```text
//请求
Range:bytes = 5001-10000
//Range:bytes = 5001-
//Range:bytes = -3000,5000-7000
```

* 针对**范围请求**，响应会返回状态码为`206 Partial Content` 的**响应报文**。
* 针对**多重范围的请求**，响应会在**首部字段**`Content-Type`标明`multipate/byteranges`后**返回响应报文。**
* 若服务器端**无法响应范围请求**，则会**返回状态码**`200 OK`和**完整的实体内容**

## 内容协商返回最合适内容

根据浏览器默认语言显示对应语言的Web页面——内容协商

以响应资源的**语言、字符集、编码方式**等作为判断的基准

* Accept
* Accept-Charset
* Accept-Encoding
* Accept-Language
* Content-Language

有三种类型

* 服务器驱动协商：以请求的首部字段为参考
* 客户端驱动协商：用户自行选择
* 透明协商：上述二者结合体

